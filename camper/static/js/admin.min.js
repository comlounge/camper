(function(){$(document).ready(function(){return $(".delete-entry").click(function(){var a,b;return a=$(this).data("entry"),b=$(this).data("url"),$.ajax({url:b,type:"POST",data:{method:"delete",entry:a},success:function(){return window.location.reload()}}),!1})})}).call(this),function(){$(document).ready(function(){return $("#show-add-form").click(function(){return $("#add-form-view").show(),$("#show-add-form").hide(),$('[data-toggle="tooltip"]').tooltip()}),$("#cancel-add-form").click(function(){return $("#add-form-view").hide(),$("#show-add-form").show(),!1}),$("#start_time").timepicker({timeFormat:"G:i"}),$("#end_time").timepicker({timeFormat:"G:i"}),$("#date").datepicker({format:"d.m.yyyy",autoclose:!0,language:$("body").data("lang")}),$("#own_location").change(function(){return this.checked?$("#location-view").show():$("#location-view").hide()}),$(".delete-event").click(function(){var a,b;return a=$(this).data("event"),b=$(this).data("url"),$.ajax({url:b,type:"POST",data:{method:"delete",event:a},success:function(){return window.location.reload()}}),!1}),$("#own_location").is(":checked")&&$("#location-view").show(),$("#bigmap").bigmap(),$("#lookup-button").click(function(){var a,b,c,d;return c=$("#location_street").val(),d=$("#location_zip").val(),a=$("#location_city").val(),b=$("#location_country").val(),$("#location-picker").modal("show"),$("#bigmap").bigmap("lookup",c,d,a,b),!1}),$("#show-on-map").click(function(){var a,b,c,d,e,f;return e=$("#location_street").val(),f=$("#location_zip").val(),a=$("#location_city").val(),b=$("#location_country").val(),""===e?void $("#error-street").popover("show"):""===a?void $("#error-street").popover("show"):($("#location-picker").modal("show"),$("#location_lat").val()?(c=$("#location_lat").val(),d=$("#location_lng").val(),$("#bigmap").bigmap("set_coords",c,d),$("#bigmap").bigmap("place")):$("#bigmap").bigmap("lookup",e,f,a,b),!1)}),$("#location-error-confirm").click(function(){return $("#location-error-box").hide(),$("#location-picker").modal("hide")}),$("#save-location-button").click(function(){return $("#location_lat").val($("#tmp_lat").val()),$("#location_lng").val($("#tmp_lng").val()),$("#own_coords").val("yes"),$("#location-picker").modal("hide")})})}.call(this),function(){var a,b;$.fn.serializeObject=function(){var a,b;return b={},a=this.serializeArray(),$.each(a,function(){return void 0!==b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""}),b},a=function(){function a(a,b){return this.elem=a,this.options=b,this.state="view",this.url=$(this.elem).closest("form").attr("action"),this}return a.prototype.clicked=function(){return this.state="view"===this.state?"edit":"view","edit"===this.state?this.show_edit_field():void 0},a.prototype.show_edit_field=function(){var a;return a=$(this.elem).data("field"),$.ajax({url:this.url,type:"GET",data:{field:a},success:function(a){return function(b){return a.payload=$(a.elem).html(),$(a.elem).html(b.html),a.escape()}}(this)})},a.prototype.close_edit_field=function(){return this.state="view",$(this.elem).html(this.payload),this.escape()},a.prototype.escape=function(){return"view"===this.state?$(document).off("keyup.editable.keys"):($(document).on("keyup.editable.keys",function(a){return function(b){return 27===b.which&&a.close_edit_field(),13===b.which&&console.log("enter"),b.preventDefault()}}(this)),$(this.elem).closest("form").submit(function(a){return a.preventDefault(),!1}))},a}(),$.fn.editable=function(b){var c;return null==b&&(b={}),c=function(b){var c,d,e;return c=$(this),d=$(this).data("editable"),e="object"==typeof b&&b,d||(d=new a(this,e),c.data("editable",d)),d.clicked()},$(this).each(c),this},$.fn.limitchars=function(a){var b;return null==a&&(a={}),b=function(){var a,b;return a=$(this),b="1234567890abcdefghijklmnopqrstuvwxyz-_",$(this).keypress(function(a){var c;return c=parseInt(a.which),13!==c&&8!==c&&0!==c&&a.ctrlKey===!1&&a.altKey===!1?-1!==b.indexOf(String.fromCharCode(c)):!0})},$(this).each(b),this},$.fn.publish_date=function(a){var b,c,d,e,f;return null==a&&(a={}),f=null,c=function(){var a,c;return f=this,a=$(f).find(".date").datepicker("getDate"),a=$(f).find(".time").timepicker("getTime",[a]),c=new Date,a>=c?e():b(),$(f).find(".edit-published").click(function(){return e()}),$(f).find(".set-now").click(function(){return d(),b()})},d=function(){var a;return a=new Date,$(f).find(".date").datepicker("setDate",[a]),$(f).find(".time").timepicker("setTime",a)},e=function(){return $(f).find(".immediate-button").hide(),$(f).find(".date-edit").show(),$(f).find(".immediate").val("False")},b=function(){return $(f).find(".date-edit").hide(),$(f).find(".immediate-button").show(),$(f).find(".immediate").val("True")},$(this).each(c),this},$.fn.view_edit_group=function(a){var b,c;return null==a&&(a={}),c=null,b=function(){return c=this,$(c).find(".input-switch").click(function(){return $(c).find(".input-controls").show(),$(c).find(".input-view").hide()}),$(c).find(".cancel-switch").click(function(){return $(c).find(".input-controls").hide(),$(c).find(".input-view").show()}),$(c).find(".submit").click(function(){var a,b;return b=$(c).data("url"),a=$(c).find("form").serializeObject(),$.ajax({url:b,type:"POST",data:a,success:function(){return function(a){return $(".workflow-"+a.new_state).attr("selected","selected"),$(".workflow-state").text(a.new_text_state),$(c).find(".input-controls").hide(),$(c).find(".input-view").show(),"published"===a.new_state?$("#publish-button").hide():$("#publish-button").show()}}(this)})})},$(this).each(b),this},b=function(a){var c,d,e;return c=function(b,c){var d;return this.options=c,this.$body=a(document.body),this.$element=a(b),this.map=null,this.marker=null,L.Icon.Default.imagePath="/static/img",L.mapbox.accessToken=this.options.accesstoken,console.log("init"),c={zoom:14},console.log(this.options),this.map=L.mapbox.map(this.$element.attr("id"),this.options.mapid,c),this.lat=null,this.lng=null,d=this.map,a("#location-picker").on("shown.bs.modal",function(){return a(".action-overlay").show(),a("#location-error").hide(),a(".spinner-overlay").hide(),d.invalidateSize(),a("#save-location-button").prop("disabled",!0)}),this},c.DEFAULTS={location_url:"",lat:null,lng:null,accesstoken:"",admin:0,mapid:"",locationurl:"",orig_lat:null,orig_lng:null,wobble:!1},c.prototype.set_coords=function(b,c){return this.lat=b,this.lng=c,a("#save-location-button").prop("disabled",!1)},c.prototype.place=function(){var b,c,d;return d=this,this.marker&&this.map.removeLayer(this.marker),this.map.setView([this.lat,this.lng]),c={},1===this.options.admin&&(c={draggable:!0}),this.marker=L.marker([this.lat,this.lng],c).addTo(this.map),b=function(){var b;return b=d.marker.getLatLng(),d.lat=b.lat,d.lng=b.lng,a("#tmp_lat").val(b.lat),a("#tmp_lng").val(b.lng)},this.marker.on("dragend",b)},c.prototype.random=function(){var a,b,c,d;return c=(Math.random()-.5)/100,d=(Math.random()-.5)/100,a=this.map.getCenter(),a.lat=a.lat+c,a.lng=a.lng+d,this.map.panTo(a),b=this,this.wobble?setTimeout(function(){return b.random()},300):void 0},c.prototype.lookup=function(c,d,e,f,g){return a("#location-loader").show(),a("#action-overlay").hide(),a(".spinner-overlay").show(),a("#location-error-box").hide(),a(".loader").show(),this.wobble=!0,this.random(),b=this,a.ajax({url:this.options.locationurl,type:"GET",data:a.param({city:e,zip:d,street:c,country:f}),success:function(c){return a(".loader").hide(),b.wobble=!1,c.success?(a(".action-overlay").show(),a("#location-error").hide(),a(".spinner-overlay").hide(),a("#save-location-button").prop("disabled",!1),b.lat=c.lat,b.lng=c.lng,b.orig_lat=c.lat,b.orig_lng=c.lng,b.place(),g?g(c):void 0):(a("#location-error-box").show(),void a("#location-error").text(c.msg).show())},error:function(){return a("#location-error-box").show(),a("#location-error").text("an unknown error occurred, please try again").show(),a("#location-error").show(),a(".action-overlay").hide(),a(".loader").hide(),b.wobble=!1}})},d=function(d){var e;return e=arguments,this.each(function(){var f,g,h;return f=a(this),g=f.data("bc.bigmap"),h=a.extend({},c.DEFAULTS,f.data(),"object"==typeof d&&d),g||(b=new c(this,h),f.data("bc.bigmap",b)),"string"==typeof d?(e=a.map(e,function(a){return[a]}),g[d].apply(g,e.slice(1))):void 0})},e=a.fn.bigmap,a.fn.bigmap=d,a.fn.bigmap.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.bigmap=e,this}},b(jQuery),$(document).ready(function(){return $(".urlscheme").limitchars(),$(".action-confirm").click(function(){var a;return a=$(this).data("confirm"),confirm(a)?!0:!1}),$("body").on("click.editable",'[data-toggle="editable"]',function(a){return $(a.target).editable()}),$(".datetime-widget .time").timepicker({timeFormat:"G:i",show24:!0}),$(".datetime-widget .date").datepicker({format:"d.m.yyyy",autoclose:!0,language:$("body").data("lang")}),$(".datetime-widget").publish_date(),$(".view-edit-group").view_edit_group(),$(".change-state").click(function(){var a,b;return b=$(this).data("url"),a=$(this).data("state"),$.ajax({url:this.url,type:"POST",data:{state:a,field:field},success:function(a){return function(b){return a.payload=$(a.elem).html(),$(a.elem).html(b.html),a.escape()}}(this)})}),tinyMCE.baseURL="/static/js/components/tinymce/",tinymce.init({selector:".wysiwyg",menubar:!1,plugins:["image","link","code"],toolbar:"undo redo | formatselect | bold italic | bullist numlist | blockquote | removeformat | image link | code",content_css:"/static/css/tinymce.css"}),$("#bigmap").bigmap(),$("#show-on-map").click(function(){var a,b,c,d,e,f;return e=$("#location_street").val(),f=$("#location_zip").val(),a=$("#location_city").val(),b=$("#location_country").val(),""===e?void $("#error-street").popover("show"):""===a?void $("#error-city").popover("show"):($("#location-picker").modal("show"),$("#location_lat").val()?(c=$("#location_lat").val(),d=$("#location_lng").val(),$("#bigmap").bigmap("set_coords",c,d),$("#bigmap").bigmap("place")):$("#bigmap").bigmap("lookup",e,f,a,b),!1)}),$("#lookup-button").click(function(){var a,b,c,d;return c=$("#location_street").val(),d=$("#location_zip").val(),a=$("#location_city").val(),b=$("#location_country").val(),$("#location-picker").modal("show"),$("#bigmap").bigmap("lookup",c,d,a,b),!1}),$("#location-error-confirm").click(function(){return $("#location-error-box").hide(),$("#location-picker").modal("hide")}),$("#save-location-button").click(function(){return $("#location_lat").val($("#tmp_lat").val()),$("#location_lng").val($("#tmp_lng").val()),$("#own_coords").val("yes"),$("#location-picker").modal("hide")}),$(".datepicker").datepicker({format:"d.m.yyyy",autoclose:!0,language:$("body").data("lang")}),$(".parsley-validate").length&&$(".parsley-validate").parsley({excluded:"input[type=file]",errorsWrapper:"<span class='errors-block help-block'></span>",errorsContainer:function(a){return a.$element.closest("div")}}).addAsyncValidator("bcslug",function(a){return a.responseJSON?a.responseJSON.validated:!1},CONFIG.slug_validation_url).addAsyncValidator("pageslug",function(a){return a.responseJSON?a.responseJSON.validated:!1},CONFIG.page_slug_validation_url),$("#bcform #slug").slugify("#name",{separator:"",whitespace:""}),$("#pageform #slug").slugify("#title",{separator:"",whitespace:"-"}),$(".delete-event").click(function(){var a,b;return a=$(this).data("event"),b=$(this).data("url"),$.ajax({url:b,type:"POST",data:{method:"delete",event:a},success:function(){return window.location.reload()}}),!1}),$(".listing").on("click",".confirmdelete",function(){var a,b;return a=$(this).data("entry"),b=$(this).data("url"),$.ajax({url:b,type:"POST",data:{method:"delete",entry:a},success:function(a){return a.reload?window.location.reload():a.url?window.location=b:a.id?($("#"+a.id).css({"background-color":"#eaa"}),$("#"+a.id).slideUp()):void 0}}),!1})})}.call(this),function(){$(document).ready(function(){return $("#imagelisting").on("click",".imagedetailblock .edittoggle",function(){var a;return $(this).closest(".imagedetails").hide(),a=$(this).data("image-id"),$("#imageform-"+a).show()}),$("#imagelisting").on("click",".imagedetailblock .canceltoggle",function(){var a;return $(this).closest(".imagedetailform").hide(),a=$(this).data("image-id"),$("#details-"+a).show()}),$("#imagelisting").on("submit",".imagedetailform",function(){var a,b;return event.preventDefault(),a=$(this).data("image-id"),b=$(this).attr("action"),$.ajax({type:"post",url:b,data:$(this).serialize(),contentType:"application/x-www-form-urlencoded",success:function(b){return $("#block-"+a).replaceWith($(b.html)),$("#imageform-"+a).hide(),$("#details-"+a).show()},error:function(){return alert("an error occurred, please try again later")}})}),$(".listing").on("click",".deletebtn",function(){var a,b,c;return a=$(this).data("image-id"),c=$(this).data("url"),b=$("body").data("i18n-areyousure"),confirm(b)&&$.ajax({url:c,type:"POST",data:{method:"delete",entry:a},success:function(a){return a.id?($("#"+a.id).css({"background-color":"#eaa"}),$("#"+a.id).slideUp()):void 0}}),!1}),$("#edittitle").click(function(){return $("#titleform").show(),$("#titleview").hide(),!1}),$("#canceltitle").click(function(){return $("#titleform").hide(),$("#titleview").show(),!1}),$("#titleform").submit(function(){var a;return event.preventDefault(),a=$(this).attr("action"),$.ajax({type:"post",url:a,data:$(this).serialize(),contentType:"application/x-www-form-urlencoded",success:function(a){return $("#gallerytitle").val(a.title),$("#titleview span").text(a.title),$("#titleform").hide(),$("#titleview").show()},error:function(){return alert("an error occurred, please try again later")}})})})}.call(this),function(){var a,b,c,d;d=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},c=function(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()},b=angular.module("barcamptool",["ui.timepicker","ui.sortable","ngTagsInput","ui.autocomplete"]),b.filter("slice",function(){return function(a,b,c){return a?a.slice(b,c):a}}),b.config(function(a){return a.startSymbol("{[{").endSymbol("}]}")}),b.controller("SessionBoardCtrl",function(a,b,d,e){return a.sessionplan={},a.sortableOptions={axis:"x",items:"td",placeholder:"sortable-placeholder",containment:"parent",cancel:".not-sortable",opacity:.5},a.room={name:"",description:"",capacity:""},a.timeslot={time:null,blocked:!1,reason:""},a.timePickerOptions={step:15,timeFormat:"G:i",minTime:"00:00",maxTime:"24:00",appendTo:"body"},b.get("sessionboard/data").success(function(b){return a.rooms=b.rooms,a.rooms.unshift({}),a.timeslots=b.timeslots,a.participants=b.participants,a.proposals=b.proposals,a.sessionplan=b.sessions}),a.roomModalMode="add",a.room_idx=null,a.add_room_form=function(){return a.roomModalMode="add",a.room={},document.getElementById("add-room-form").reset(),$("#add-room-modal").modal("show"),void $("#room-form-name").focus()},a.add_room=function(){a.room_form.$error.$invalid||(a.room.id=c(),a.rooms.push(a.room),a.room=angular.copy(a.room),$("#add-room-modal").modal("hide"))},a.edit_room=function(b){a.roomModalMode="edit",a.room=angular.copy(a.rooms[b]),a.room_idx=b,$("#add-room-modal").modal("show")},a.update_room=function(){a.room_form.$error.$invalid||(a.rooms[a.room_idx]=a.room,$("#add-room-modal").modal("hide"))},a.delete_room=function(b){return void a.rooms.splice(b,1)},a.timeslotModalMode="add",a.timeslot_idx=null,a.add_timeslot_form=function(){var b,c,d,e;a.timeslotModalMode="add",document.getElementById("add-timeslot-form").reset(),a.timeslots.length?(d=new Date(angular.copy(a.timeslots[a.timeslots.length-1]).time),d=new Date(d.getTime()+6e4*d.getTimezoneOffset()),e=new Date(d.getTime()+36e5),$("#timepicker").timepicker("setTime",e),a.timeslot.time=e):(b=Date.now(),c=new Date,c.setTime(b),c.setHours(9),c.setMinutes(0),c.setSeconds(0),$("#timepicker").timepicker("option","minTime","00:00"),$("#timepicker").timepicker("setTime",c),a.timeslot.time=c),$("#add-timeslot-modal").modal("show"),$("#timepicker").focus()},a.add_timeslot=function(){var b,c,d,e;a.timeslot_form.$error.$invalid||(b=a.timeslot.time,d=new Date,c=d.getTimezoneOffset(),e=new Date(b.getTime()-6e4*c),a.timeslot.time=e,a.timeslots.push(a.timeslot),a.timeslots=_.sortBy(a.timeslots,function(a){var b;return b=a.time,"string"==typeof b?new Date(b):b}),a.timeslot=angular.copy(a.timeslot),$("#add-timeslot-modal").modal("hide"),a.timeslot.blocked=!1,a.timeslot.reason="")},a.delete_timeslot=function(b){return void a.timeslots.splice(b,1)},a.session_id=null,a.session={},a.add_session=function(b,d){var f,g,h,i;f=new Date(b.time),g=e("date")(f,"hh:mm","UTC"),h=a.session_idx=d.id+"@"+g,a.session=a.sessionplan.hasOwnProperty(h)?angular.copy(a.sessionplan[h]):{sid:c(),slug:"",_id:h,title:"",description:"",moderator:[]},$("#edit-session-modal").modal("show"),$("#ac-title").focus(),i=null,$("#ac-title").autocomplete({source:a.proposals,appendTo:"#edit-session-modal",open:function(){return i=null},select:function(a,b){return i=b},change:function(){var b,c,d;return b=!1,i?(d=i.item.value,c=i.item.user_id,a.$apply(function(){var b,e,f,g;for(g=a.participants,e=0,f=g.length;f>e;e++)if(b=g[e],b._id===c){a.session.moderator=[b];break}return a.session.title=d,a.session.description=i.item.description})):void 0}})},a.update_session=function(){var b,c,d,e,f,g,h;for(b=a.session._id,a.session=angular.copy(a.session),c=a.session.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),g=0,f=c+"";;){h=a.sessionplan;for(e in h)if(d=h[e],d.slug===f&&b!==e){g++,f=c+g;break}break}a.session.slug=f,a.sessionplan[b]=a.session,$("#edit-session-modal").modal("hide")},a.get_session_id=function(a,b){var c,d,f;return c=new Date(a.time),d=e("date")(c,"hh:mm","UTC"),f=b.id+"@"+d},a.loadParticipants=function(){var b;return b=d.defer(),b.resolve(a.participants),b.promise},a.save_to_server=function(){var c,d;return d=angular.copy(a.rooms),d.splice(0,1),c={rooms:d,timeslots:a.timeslots,sessions:a.sessionplan},b.post("sessionboard/data",c).success(function(){}).error(function(){})},a.$watch("rooms",function(b,c){return void(b!==c&&a.save_to_server())},!0),a.$watch("timeslots",function(b,c){return void(b!==c&&a.save_to_server())},!0),a.$watch("sessionplan",function(b,c){return void(b!==c&&a.save_to_server())},!0)}),a=/^[0-9]+$/i,b.directive("integer",function(){return{restrict:"AE",require:"ngModel",link:function(b,c,d,e){return e.$validators.integer=function(b,c){return e.$isEmpty(b)?!0:c.match(a)?!0:!1}}}})}.call(this);
//# sourceMappingURL=admin.min.map