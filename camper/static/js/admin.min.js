(function(){$(document).ready(function(){return $(".delete-entry").click(function(){var t=$(this).data("entry"),e=$(this).data("url");return $.ajax({url:e,type:"POST",data:{method:"delete",entry:t},success:function(){return window.location.reload()}}),!1})})}).call(this),function(){$(document).ready(function(){return $("#show-add-form").click(function(){return $("#add-form-view").show(),$("#show-add-form").hide(),$('[data-toggle="tooltip"]').tooltip()}),$("#cancel-add-form").click(function(){return $("#add-form-view").hide(),$("#show-add-form").show(),!1}),$("#start_time").timepicker({timeFormat:"G:i"}),$("#end_time").timepicker({timeFormat:"G:i"}),$("#date").datepicker({format:"d.m.yyyy",autoclose:!0,language:$("body").data("lang")}),$("#own_location").change(function(){return this.checked?$("#location-view").show():$("#location-view").hide()}),$(".delete-event").click(function(t){var e;return t.preventDefault(),e=$("body").data("i18n-areyousure"),confirm(e)&&(t=$(this).data("event"),e=$(this).data("url"),$.ajax({url:e,type:"POST",data:{method:"delete",event:t},success:function(){return window.location.reload()}})),!1}),$("#own_location").is(":checked")&&$("#location-view").show(),$("#bigmap").bigmap(),$("#lookup-button").click(function(){var t=$("#location_street").val(),e=$("#location_zip").val(),o=$("#location_city").val(),i=$("#location_country").val();return $("#location-picker").modal("show"),$("#bigmap").bigmap("lookup",t,e,o,i),!1}),$("#show-on-map").click(function(){var t,e,o=$("#location_street").val(),i=$("#location_zip").val(),a=$("#location_city").val(),n=$("#location_country").val();if(""!==o){if(""!==a)return $("#location-picker").modal("show"),$("#location_lat").val()?(t=$("#location_lat").val(),e=$("#location_lng").val(),$("#bigmap").bigmap("set_coords",t,e),$("#bigmap").bigmap("place")):$("#bigmap").bigmap("lookup",o,i,a,n),!1;$("#error-street").popover("show")}else $("#error-street").popover("show")}),$("#location-error-confirm").click(function(){return $("#location-error-box").hide(),$("#location-picker").modal("hide")}),$("#save-location-button").click(function(){return $("#location_lat").val($("#tmp_lat").val()),$("#location_lng").val($("#tmp_lng").val()),$("#own_coords").val("yes"),$("#location-picker").modal("hide")})})}.call(this),function(){var i,s;function t(t,e){return this.elem=t,this.options=e,this.state="view",this.url=$(this.elem).closest("form").attr("action"),this}$.fn.serializeObject=function(){var t={},e=this.serializeArray();return $.each(e,function(){return void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},t.prototype.clicked=function(){if(this.state="view"===this.state?"edit":"view","edit"===this.state)return this.show_edit_field()},t.prototype.show_edit_field=function(){var e,t=$(this.elem).data("field");return $.ajax({url:this.url,type:"GET",data:{field:t},success:(e=this,function(t){return e.payload=$(e.elem).html(),$(e.elem).html(t.html),e.escape()})})},t.prototype.close_edit_field=function(){return this.state="view",$(this.elem).html(this.payload),this.escape()},t.prototype.escape=function(){return"view"===this.state?$(document).off("keyup.editable.keys"):($(document).on("keyup.editable.keys",(e=this,function(t){return 27===t.which&&e.close_edit_field(),13===t.which&&console.log("enter"),t.preventDefault()})),$(this.elem).closest("form").submit(function(t){return t.preventDefault(),!1}));var e},i=t,$.fn.editable=function(t){return null==t&&(t={}),t=function(t){var e=$(this),o=$(this).data("editable");return o||(o=new i(this,"object"==typeof t&&t),e.data("editable",o)),o.clicked()},$(this).each(t),this},$.fn.limitchars=function(t){return null==t&&(t={}),t=function(t){$(this);return $(this).keypress(function(t){var e=parseInt(t.which);return 13===e||8===e||0===e||(!1!==t.ctrlKey||!1!==t.altKey||-1!=="1234567890abcdefghijklmnopqrstuvwxyz-_".indexOf(String.fromCharCode(e)))})},$(this).each(t),this},$.fn.publish_date=function(t){var o,i,a,n;return null==t&&(t={}),n=null,t=function(t){var e;return n=this,e=$(n).find(".date").datepicker("getDate"),e=$(n).find(".time").timepicker("getTime",[e]),(new Date<=e?a:o)(),$(n).find(".edit-published").click(function(){return a()}),$(n).find(".set-now").click(function(){return i(),o()})},i=function(){var t=new Date;return $(n).find(".date").datepicker("setDate",[t]),$(n).find(".time").timepicker("setTime",t)},a=function(){return $(n).find(".immediate-button").hide(),$(n).find(".date-edit").show(),$(n).find(".immediate").val("False")},o=function(){return $(n).find(".date-edit").hide(),$(n).find(".immediate-button").show(),$(n).find(".immediate").val("True")},$(this).each(t),this},$.fn.view_edit_group=function(t){var o;return null==t&&(t={}),t=function(t){return o=this,$(o).find(".input-switch").click(function(){return $(o).find(".input-controls").show(),$(o).find(".input-view").hide()}),$(o).find(".cancel-switch").click(function(){return $(o).find(".input-controls").hide(),$(o).find(".input-view").show()}),$(o).find(".submit").click(function(){var t=$(o).data("url"),e=$(o).find("form").serializeObject();return $.ajax({url:t,type:"POST",data:e,success:function(t){return $(".workflow-"+t.new_state).attr("selected","selected"),$(".workflow-state").text(t.new_text_state),$(o).find(".input-controls").hide(),$(o).find(".input-view").show(),"published"===t.new_state?$("#publish-button").hide():$("#publish-button").show()}})})},$(this).each(t),this},(s=function(n){var t,e,r=function(t,e){var o;return this.options=e,this.$body=n(document.body),this.$element=n(t),this.map=null,this.marker=null,L.Icon.Default.imagePath="/static/img/",L.mapbox.accessToken=this.options.accesstoken,console.log("init"),e={zoom:14},this.map=L.mapbox.map(this.$element.attr("id")),this.map.addLayer(L.mapbox.styleLayer("mapbox://styles/mapbox/streets-v11")),this.lat=null,this.lng=null,o=this.map,n("#location-picker").on("shown.bs.modal",function(){return n(".action-overlay").show(),n("#location-error").hide(),n(".spinner-overlay").hide(),o.invalidateSize(),n("#save-location-button").prop("disabled",!0)}),this};return r.DEFAULTS={location_url:"",lat:null,lng:null,accesstoken:"",admin:0,mapid:"",locationurl:"",orig_lat:null,orig_lng:null,wobble:!1},r.prototype.set_coords=function(t,e){return this.lat=t,this.lng=e,n("#save-location-button").prop("disabled",!1)},r.prototype.place=function(){var t,o=this;return this.marker&&this.map.removeLayer(this.marker),this.map.setView([this.lat,this.lng],14),t={},1===this.options.admin&&(t={draggable:!0}),this.marker=L.marker([this.lat,this.lng],t).addTo(this.map),t=function(t){var e=o.marker.getLatLng();return o.lat=e.lat,o.lng=e.lng,n("#tmp_lat").val(e.lat),n("#tmp_lng").val(e.lng)},this.marker.on("dragend",t)},r.prototype.random=function(){var t,e=(Math.random()-.5)/100,o=(Math.random()-.5)/100,i=this.map.getCenter();if(i.lat=i.lat+e,i.lng=i.lng+o,this.map.panTo(i),(t=this).wobble)return setTimeout(function(){return t.random()},300)},r.prototype.lookup=function(t,e,o,i,a){return n("#location-loader").show(),n("#action-overlay").hide(),n(".spinner-overlay").show(),n("#location-error-box").hide(),n(".loader").show(),this.wobble=!0,this.random(),s=this,n.ajax({url:this.options.locationurl,type:"GET",data:n.param({city:o,zip:e,street:t,country:i}),success:function(t){return n(".loader").hide(),s.wobble=!1,t.success?(n(".action-overlay").show(),n("#location-error").hide(),n(".spinner-overlay").hide(),n("#save-location-button").prop("disabled",!1),s.lat=t.lat,s.lng=t.lng,s.orig_lat=t.lat,s.orig_lng=t.lng,s.place(),a?a(t):void 0):(n("#location-error-box").show(),void n("#location-error").text(t.msg).show())},error:function(t){return n("#location-error-box").show(),n("#location-error").text("an unknown error occurred, please try again").show(),n("#location-error").show(),n(".action-overlay").hide(),n(".loader").hide(),s.wobble=!1}})},t=function(i){var a=arguments;return this.each(function(){var t=n(this),e=t.data("bc.bigmap"),o=n.extend({},r.DEFAULTS,t.data(),"object"==typeof i&&i);if(e||(s=new r(this,o),t.data("bc.bigmap",s)),"string"==typeof i)return a=n.map(a,function(t,e){return[t]}),e[i].apply(e,a.slice(1))})},e=n.fn.bigmap,n.fn.bigmap=t,n.fn.bigmap.Constructor=r,n.fn.modal.noConflict=function(){return n.fn.bigmap=e,this}})(jQuery),$(function(){return $(".delete-tc").click(function(t){return t.preventDefault(),t=$("body").data("i18n-areyousure"),confirm(t)&&(t=$(this).data("url"),$.ajax({url:t,type:"POST",data:{method:"delete"},success:function(){return window.location.reload()}})),!1}),$(".colorpicker-container").colorpicker(),$(".urlscheme").limitchars(),$(".action-confirm").click(function(){var t=$(this).data("confirm");return!!confirm(t)}),$("body").on("click.editable",'[data-toggle="editable"]',function(t){return $(t.target).editable()}),$(".datetime-widget .time").timepicker({timeFormat:"G:i",show24:!0}),$(".datetime-widget .date").datepicker({format:"d.m.yyyy",autoclose:!0,language:$("body").data("lang")}),$(".datetime-widget").publish_date(),$(".view-edit-group").view_edit_group(),$(".change-state").click(function(){$(this).data("url");var e,t=$(this).data("state");return $.ajax({url:this.url,type:"POST",data:{state:t,field:field},success:(e=this,function(t){return e.payload=$(e.elem).html(),$(e.elem).html(t.html),e.escape()})})}),tinyMCE.baseURL="/static/js/tinymce/",tinymce.init({selector:".wysiwyg",menubar:!1,convert_urls:!0,relative_urls:!1,remove_script_host:!1,plugins:["image","link","code"],toolbar:"undo redo | formatselect | bold italic | bullist numlist | blockquote | removeformat | image link | code",content_css:"/static/css/tinymce.css"}),$("#bigmap").bigmap(),$("#show-on-map").click(function(){var t,e,o=$("#location_street").val(),i=$("#location_zip").val(),a=$("#location_city").val(),n=$("#location_country").val();if(""!==o){if(""!==a)return $("#location-picker").modal("show"),$("#location_lat").val()?(t=$("#location_lat").val(),e=$("#location_lng").val(),$("#bigmap").bigmap("set_coords",t,e),$("#bigmap").bigmap("place")):$("#bigmap").bigmap("lookup",o,i,a,n),!1;$("#error-city").popover("show")}else $("#error-street").popover("show")}),$("#lookup-button").click(function(){var t=$("#location_street").val(),e=$("#location_zip").val(),o=$("#location_city").val(),i=$("#location_country").val();return $("#location-picker").modal("show"),$("#bigmap").bigmap("lookup",t,e,o,i),!1}),$("#location-error-confirm").click(function(){return $("#location-error-box").hide(),$("#location-picker").modal("hide")}),$("#save-location-button").click(function(){return $("#location_lat").val($("#tmp_lat").val()),$("#location_lng").val($("#tmp_lng").val()),$("#own_coords").val("yes"),$("#location-picker").modal("hide")}),$(".datepicker").datepicker({format:"d.m.yyyy",autoclose:!0,language:$("body").data("lang")}),$(".parsley-validate").length&&$(".parsley-validate").parsley({excluded:"input[type=file]",errorsWrapper:"<span class='errors-block help-block'></span>",errorsContainer:function(t){return t.$element.closest("div")}}).addAsyncValidator("bcslug",function(t){return!!t.responseJSON&&t.responseJSON.validated},CONFIG.slug_validation_url).addAsyncValidator("pageslug",function(t){return!!t.responseJSON&&t.responseJSON.validated},CONFIG.page_slug_validation_url),$("#bcform #slug").slugify("#name",{separator:"",whitespace:""}),$("#pageform #slug").slugify("#title",{separator:"",whitespace:"-"}),$(".listing").on("click",".confirmdelete",function(){var t=$(this).data("entry"),e=$(this).data("url");return $.ajax({url:e,type:"POST",data:{method:"delete",entry:t},success:function(t){return t.reload?window.location.reload():t.url?window.location=e:t.id?($("#"+t.id).css({"background-color":"#eaa"}),$("#"+t.id).slideUp()):void 0}}),!1})})}.call(this),function(){$(function(){return $("#imagelisting").on("click",".imagedetailblock .edittoggle",function(){var t;return $(this).closest(".imagedetails").hide(),t=$(this).data("image-id"),$("#imageform-"+t).show()}),$("#imagelisting").on("click",".imagedetailblock .canceltoggle",function(){var t;return $(this).closest(".imagedetailform").hide(),t=$(this).data("image-id"),$("#details-"+t).show()}),$("#imagelisting").on("submit",".imagedetailform",function(){var e,t;return event.preventDefault(),e=$(this).data("image-id"),t=$(this).attr("action"),$.ajax({type:"post",url:t,data:$(this).serialize(),contentType:"application/x-www-form-urlencoded",success:function(t){return $("#block-"+e).replaceWith($(t.html)),$("#imageform-"+e).hide(),$("#details-"+e).show()},error:function(){return alert("an error occurred, please try again later")}})}),$(".listing").on("click",".deletebtn",function(){var t=$(this).data("image-id"),e=$(this).data("url"),o=$("body").data("i18n-areyousure");return confirm(o)&&$.ajax({url:e,type:"POST",data:{method:"delete",entry:t},success:function(t){if(t.id)return $("#"+t.id).css({"background-color":"#eaa"}),$("#"+t.id).slideUp()}}),!1}),$("#edittitle").click(function(){return $("#titleform").show(),$("#titleview").hide(),!1}),$("#canceltitle").click(function(){return $("#titleform").hide(),$("#titleview").show(),!1}),$("#titleform").submit(function(){var t;return event.preventDefault(),t=$(this).attr("action"),$.ajax({type:"post",url:t,data:$(this).serialize(),contentType:"application/x-www-form-urlencoded",success:function(t){return $("#gallerytitle").val(t.title),$("#titleview span").text(t.title),$("#titleform").hide(),$("#titleview").show()},error:function(){return alert("an error occurred, please try again later")}})})})}.call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}var e;function o(){this.update=t(this.update,this),this.init=t(this.init,this),this.canvas=$("#logocanvas")[0],this.final_canvas=$("#finalcanvas")[0],this.export_canvas=$("#exportcanvas")[0],this.tmp_text=$("#tmp_text"),this.icon_svg=$("#icon-svg"),this.icon_img=null,this.textinput1=$("#logoinput1"),this.textinput2=$("#logoinput2"),this.colorinput_logo=$("#colorinput_logo"),this.colorinput1=$("#colorinput1"),this.colorinput2=$("#colorinput2"),$("#logo_color_logo").val()&&this.colorinput_logo.val($("#logo_color_logo").val()),$("#logo_color1").val()&&this.colorinput1.val($("#logo_color1").val()),$("#logo_color2").val()&&this.colorinput2.val($("#logo_color2").val()),$("#logo_text1").val()&&this.textinput1.val($("#logo_text1").val()),$("#logo_text2").val()&&this.textinput2.val($("#logo_text2").val()),this.text1=this.textinput1.val(),this.text2=this.textinput2.val(),this.color_logo=this.colorinput_logo.val(),this.color1=this.colorinput1.val(),this.color2=this.colorinput2.val()}o.prototype.font_weight=180,o.prototype.font_family="Open Sans",o.prototype.icon_factor=2.7,o.prototype.icon_label_scale=2,o.prototype.init=function(){return this.init_ui(),this.init_icon(),this.update()},o.prototype.init_icon=function(t){},o.prototype.init_ui=function(){var e,o,i,a;return $(".colorpicker-container-logo").colorpicker().on("changeColor",(e=this,function(t){return e.color_logo=e.colorinput_logo.val(),e.color1=e.colorinput1.val(),e.color2=e.colorinput2.val(),e.update()})),$(".logoinput").on("keyup",(o=this,function(t){return o.text1=o.textinput1.val(),o.text2=o.textinput2.val(),o.update()})),$("#save-as-logo-button").click((i=this,function(t){return t.preventDefault(),$("#logo_color_logo").val(i.colorinput_logo.val()),$("#logo_color1").val(i.colorinput1.val()),$("#logo_color2").val(i.colorinput2.val()),$("#logo_text1").val(i.textinput1.val()),$("#logo_text2").val(i.textinput2.val()),t=function(t){var t=t.toDataURL("image/png").split(","),t=t[t.length-1];return $("#save-as-logo-button").hide(),$("#saving-as-logo-button").show(),$.ajax({url:$("#logoeditor-modal").data("upload-url"),type:"POST",data:{data:t,filename:""+i.text1+i.text2+"logo.png"},success:function(t){var e=$("#uploadwidget-logo");return $("#logo").val(t.asset_id),e.find(".uploader-buttons").show(),e.find(".preview-area img").attr("src",t.url),e.find(".progress").hide(),e.find(".preview-area").show(),$("#logoeditor-modal").modal("hide"),$("#save-as-logo-button").show(),$("#saving-as-logo-button").hide()},error:function(){return $("#save-as-logo-button").show(),$("#saving-as-logo-button").hide()}})},i.draw_logo(i.final_canvas,1.5,t)})),$("#save-as-png-button").click((a=this,function(t){return t.preventDefault(),t=function(t){var e=document.createElement("a");e.download=""+a.text1+a.text2+"logo.png",e.href=t.toDataURL("image/png"),e.click()},a.draw_logo(a.export_canvas,3.8,t),$("#logoeditor-modal").modal("hide")}))},o.prototype.update=function(){return this.draw_logo(this.canvas,1.1)},o.prototype.draw_logo=function(t,e,o){var i,a,n,r;return null==e&&(e=1),null==o&&(o=null),i=t.getContext("2d"),n=(a=this.compute_scale(t,e)).scale,r=a.text_width1,e=a.icon_width,console.log("drawing with scale "+a.scale),i.clearRect(0,0,t.width,t.height),this.draw_text(t,n,e,e+r),this.draw_icon(t,n,o)},o.prototype.compute_scale=function(t,e){var o="bold "+.7*this.font_weight+"px "+this.font_family,i="normal "+.7*this.font_weight+"px "+this.font_family,a=$("#tmp_text").css("font",o).text(this.text1).width(),n=$("#tmp_text").css("font",i).text(this.text2).width(),o=90*this.icon_factor,i=1.1*(o+a+n),i=this.canvas.width/i,i=Math.min(1,.98*i);return{scale:i*e,icon_width:o*i*e,text_width1:a*i*e,text_width2:n*i*e}},o.prototype.draw_text=function(t,e,o,i){var a,n,r=t.getContext("2d");return r.clearRect(o,0,t.width-o,t.height),a="bold "+this.font_weight*e*.7+"px "+this.font_family,n="normal "+this.font_weight*e*.7+"px "+this.font_family,r.font=a,r.fillStyle=this.color1,r.fillText(this.text1,o,t.height/2+40*e),r.fillStyle=this.color2,r.font=n,r.fillText(this.text2,i,t.height/2+40*e)},o.prototype.draw_icon=function(e,o,i){var t,a,n,r,s;return null==i&&(i=null),a=e.getContext("2d"),r=this.icon_factor*o,(t=this.icon_svg.find("g#container")).attr("transform","scale("+r+")"),$(t.children()[0]).css("fill",this.color_logo),(n=new Image(90*this.icon_factor*o,90*this.icon_factor*o)).src="data:image/svg+xml;base64,"+window.btoa($(this.icon_svg).prop("outerHTML")),n.onload=(s=this,function(){var t=e.height/2-o*s.icon_factor*45;if(a.drawImage(n,0,t),i)return i(e)})},o.prototype.resize=function(){return this.draw_logo(this.canvas)},e=o,$(function(){if($("#logocanvas").length)return(new e).init()})}.call(this),function(){function o(t,e){return function(){return t.apply(e,arguments)}}var i,t,e,c,a,n,r;function s(t,e){this.element=t,this.del_session=o(this.del_session,this),this.update_session=o(this.update_session,this),this.add_session_modal=o(this.add_session_modal,this),this.del_timeslot=o(this.del_timeslot,this),this.add_timeslot=o(this.add_timeslot,this),this.add_timeslot_modal=o(this.add_timeslot_modal,this),this.edit_room=o(this.edit_room,this),this.edit_room_modal=o(this.edit_room_modal,this),this.del_room=o(this.del_room,this),this.add_room=o(this.add_room,this),this.add_room_modal=o(this.add_room_modal,this),this.delete_all_sessions=o(this.delete_all_sessions,this),this.data={},this.options=c.extend({},n,e),this._defaults=n,this._name=r,this.init()}Array.prototype.toDict=function(o){return this.reduce(function(t,e){return null!=e[o]&&(t[e[o]]=e),t},{})},e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},i=function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},$.fn.serializeObject=function(){var t={},e=this.serializeArray();return $.each(e,function(){return void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},t=function(){var t=$("body").data("lang");return $.ajax({url:"/static/js/camper-"+t+".json",type:"GET",dataType:"json",success:function(t){var a=new Jed(t),o=function(t,e){return a.translate(t).fetch(e)},n=function(t,e,o,i){return a.translate(t).ifPlural(o,e).fetch(i)};return Handlebars.registerHelper("trans",function(t){var e=t.fn(this);return o(e,t.hash)}),Handlebars.registerHelper("_",function(t,e){return o(t,e.hash)}),Handlebars.registerHelper("ntrans",function(t,e){var o=e.fn(this),i=e.inverse(this);return n(o,i,t,e.hash)}),Handlebars.registerHelper("n_",function(t,e,o,i){return n(e,o,t,i.hash)}),$("#newsessions").sessionboard()},error:function(){return alert("Could not load translations, please try again later")}})},c=jQuery,window,document,r="sessionboard",n={foo:"bar"},s.prototype.init=function(){return this.loadState(),c("#delete-all-sessions").click((t=this,function(){return t.delete_all_sessions()}));var t},s.prototype.update=function(){return this.saveState(),this.render()},s.prototype.loadState=function(){return c.ajax({url:"sessionboard/data",dataType:"json",cache:!1,success:(e=this,function(t){return e.data=t,e.render()}),error:function(t,e,o){return console.error("url",e,o.toString())}});var e},s.prototype.saveState=function(){var e;this.data.rooms,this.data.timeslots,this.data.sessions;return c.ajax({url:"sessionboard/data",data:JSON.stringify(this.data),contentType:"application/json",type:"POST",success:function(t){},error:(e=this,function(t){return alert("an error occurred saving the data"),e.loadState()})})},s.prototype.get_session_id=function(t,e){return e.id+"@"+t.time},s.prototype.generate_sessiontable=function(){for(var t,e,o,i,a,n,r=[],s=this.data.timeslots,l=0,d=s.length;l<d;l++){for(i={time:(n=s[l]).time,blocked:n.blocked,block_reason:n.reason,slots:[]},t=0,e=(o=this.data.rooms).length;t<e;t++)a=o[t],a=this.get_session_id(n,a),this.data.sessions[a]?i.slots.push(this.data.sessions[a]):i.slots.push({_id:a});r.push(i)}return r},s.prototype.render=function(){var t=JST.sessiontest({data:this.data,sessions:this.generate_sessiontable(),colwidth:90/(this.data.rooms.length+1)});return c("#newsessions").html(t),this.init_handlers()},s.prototype.delete_all_sessions=function(){return this.data.sessions={},this.update()},s.prototype.add_room_modal=function(){var t=JST["room-modal"]({add_room:!0});return c("#modals").html(t),c("#add-room-modal").modal("show"),c("#room-form-name").focus(),c("#add-room-form").submit(this.add_room),!1},s.prototype.add_room=function(t){return t.preventDefault(),(t=c("#add-room-form").serializeObject()).id=i(),this.data.rooms.push(t),this.update(),c("#add-room-modal").modal("hide"),!1},s.prototype.del_room=function(t){if(confirm(c("body").data("i18n-areyousure")))return t=c(t.currentTarget).data("index"),this.data.rooms.splice(t,1),this.update()},s.prototype.edit_room_modal=function(t){var e=c(t.currentTarget).data("index"),t=this.data.rooms[e],e=JST["room-modal"]({room:t,room_idx:e,add_room:!1});return c("#modals").html(e),c("#add-room-modal").modal("show"),c("#room-form-name").focus(),c("#add-room-form").submit(this.edit_room),!1},s.prototype.edit_room=function(t){var e;return t.preventDefault(),(t=(e=c("#add-room-form").serializeObject()).room_idx)?((e=JSON.parse(JSON.stringify(e))).room_idx&&delete e.room_idx,this.data.rooms[t]=e,this.update(),c("#add-room-modal").modal("hide"),!1):(console.error("room index was missing"),alert("Error"))},s.prototype.set_next_time=function(){var t,e,o,i=this.data.timeslots.length;if(!i)return c("#timepicker").timepicker("option","minTime","00:00"),c("#timepicker").timepicker("setTime","09:00");e=this.data.timeslots[i-1].time;try{return o=e.split(":"),t=parseInt(o[0])+1,c("#timepicker").timepicker("setTime",t+":"+o[1])}catch(t){}},s.prototype.add_timeslot_modal=function(t){var e=JST["timeslot-modal"]();return c("#modals").html(e),c("#timepicker").timepicker({timeFormat:"G:i",show24:!0,step:15}),this.set_next_time(),c("#add-timeslot-modal").modal("show"),c("#timepicker").focus(),c("#add-timeslot-form").parsley(),c("#add-timeslot-form").submit(this.add_timeslot),!1},s.prototype.add_timeslot=function(t){t.preventDefault(),1===(t=c("#add-timeslot-form").serializeObject()).time.split(":")[0].length&&(t.time="0"+t.time),this.data.timeslots.push(t),this.data.timeslots=_.sortBy(this.data.timeslots,"time"),this.update(),c("#add-timeslot-modal").modal("hide")},s.prototype.del_timeslot=function(t){if(confirm(c("body").data("i18n-areyousure")))return t=c(t.currentTarget).data("index"),this.data.timeslots.splice(t,1),this.update()},s.prototype.add_session_modal=function(t){var d,e=c(t.currentTarget).closest(".sessionslot").data("id"),t=this.data.sessions[e];return(t=t||{}).session_idx=e,t=JST["session-modal"](t),c("#modals").html(t),t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,local:this.data.participants.map(function(t){return t.name})}),c("#moderator").tagsinput({tagClass:"btn btn-info btn-xs",typeaheadjs:{source:t.ttAdapter()}}),t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:this.data.proposals}),c("#ac-title").typeahead(null,{name:"proposals",display:"value",templates:{suggestion:Handlebars.compile("<div>{{label}}</div>")},source:t.ttAdapter()}).bind("typeahead:select",(d=this,function(t,e,o){var i,a,n,r,s,l;for(c("#session-description").text(e.description),c("#ac-title").text(e.value),l=e.user_id,r=[],i=0,a=(n=d.data.participants).length;i<a;i++)(s=n[i])._id===l?(c("#moderator").tagsinput("removeAll"),r.push(c("#moderator").tagsinput("add",s.name))):r.push(void 0);return r})),c("#edit-session-modal").modal("show"),c("#ac-title").focus(),c("#edit-session-form").submit(this.update_session)},s.prototype.update_session=function(t){var e;return t.preventDefault(),e=c("#edit-session-form").serializeObject(),console.log(e),e.session_idx||alert("An error occurred, please reload the page"),t={sid:i(),slug:null,_id:e.session_idx,title:e.title,description:e.description,interested:e.interested,confurl:e.confurl,moderator:e.moderator},this.data.sessions[e.session_idx]=t,this.update(),c("#edit-session-modal").modal("hide"),!1},s.prototype.del_session=function(t){var e;return confirm(c("body").data("i18n-areyousure"))&&(e=c(t.currentTarget).closest(".sessionslot").data("id"),c(t.currentTarget).closest(".sessionslot").attr("id"),delete this.data.sessions[e],this.saveState(),this.render()),!1},s.prototype.init_handlers=function(){var i,a,n;try{i=this.data.rooms.toDict("id")}catch(t){i={}}return c("#roomcontainment").sortable({axis:"x",helper:"clone",items:"th",placeholder:"sortable-placeholder",containment:"parent",cancel:".not-sortable",opacity:.5,update:(a=this,function(t,e){var o=[];return c("#newsessions #roomcontainment .sorted").each(function(){var t=c(this).data("id");return o.push(i[t])}),a.data.rooms=o,a.update()})}),c(".sessionslot.enabled").draggable({revert:!0,snap:".sessionslot.enabled",zIndex:1e4}).droppable({hoverClass:"btn btn-info",drop:(n=this,function(t,e){var o=e.draggable.data("id"),e=c(t.target).data("id"),t=n.data.sessions[e];return n.data.sessions[e]=n.data.sessions[o],n.data.sessions[e]._id=e,t?(n.data.sessions[o]=t)._id=o:delete n.data.sessions[o],n.update()})}),c("#add-room-modal-button").click(this.add_room_modal),c(".del-room-button").click(this.del_room),c(".edit-room-modal-button").click(this.edit_room_modal),c("#add-timeslot-modal-button").click(this.add_timeslot_modal),c(".del-timeslot-button").click(this.del_timeslot),c(".edit-session-button").click(this.add_session_modal),c(".del-session-button").click(this.del_session)},a=s,c.fn[r]=function(t){return this.each(function(){if(!c.data(this,"plugin_"+r))return c.data(this,"plugin_"+r,new a(this,t))})},$(function(){return t(),$(".dropdown-toggle").dropdown()})}.call(this);
//# sourceMappingURL=admin.min.js.map